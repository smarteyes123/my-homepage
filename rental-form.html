<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>è³ƒè²¸ç‰©ä»¶ãŠå•ã„åˆã‚ã› | æ ªå¼ä¼šç¤¾ã‚¹ãƒãƒ¼ãƒˆã‚¢ã‚¤ã‚º</title>
  <meta name="description" content="è³ƒè²¸ç‰©ä»¶ã‚’ãŠæ¢ã—ã®æ–¹å‘ã‘ã®ãŠå•ã„åˆã‚ã›ãƒ•ã‚©ãƒ¼ãƒ ã€‚ã”å¸Œæœ›ã®æ¡ä»¶ã‚’ãŠèã‹ã›ãã ã•ã„ã€‚" />
  <meta property="og:title" content="è³ƒè²¸ç‰©ä»¶ãŠå•ã„åˆã‚ã› | æ ªå¼ä¼šç¤¾ã‚¹ãƒãƒ¼ãƒˆã‚¢ã‚¤ã‚º" />
  <meta property="og:description" content="è³ƒè²¸ç‰©ä»¶ã‚’ãŠæ¢ã—ã®æ–¹å‘ã‘ã®ãŠå•ã„åˆã‚ã›ãƒ•ã‚©ãƒ¼ãƒ ã€‚ã”å¸Œæœ›ã®æ¡ä»¶ã‚’ãŠèã‹ã›ãã ã•ã„ã€‚" />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://www.smarteyes.co.jp/rental-form.html" />
  <link rel="icon" href="logo.png" />
  <style>
    /* ===== Enhanced Color Palette ===== */
    :root{
      --brand:#1e40af;
      --brand-light:#3b82f6;
      --brand-ink:#0f172a;
      --gold:#f59e0b;
      --gold-light:#fbbf24;
      --ink:#0f172a;
      --ink-light:#334155;
      --muted:#64748b;
      --muted-light:#94a3b8;
      --bg:linear-gradient(135deg, #f1f5f9 0%, #e2e8f0 100%);
      --bg-solid:#f8fafc;
      --card:#ffffff;
      --card-hover:#fefefe;
      --accent:#06b6d4;
      --accent-light:#67e8f9;
      --success:#10b981;
      --warning:#f59e0b;
      --error:#ef4444;
      --radius:16px;
      --shadow:0 4px 20px rgba(30, 64, 175, 0.08);
      --shadow-hover:0 10px 40px rgba(30, 64, 175, 0.15);
      --transition:all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }
    *{box-sizing:border-box}
    html{scroll-behavior:smooth}
    html,body{margin:0;padding:0;background:var(--bg-solid);color:var(--ink);font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Inter,"Hiragino Kaku Gothic ProN","Hiragino Sans","Noto Sans JP","Microsoft YaHei",sans-serif;}
    a{color:inherit;text-decoration:none}
    img{max-width:100%;display:block}
    .container{max-width:1200px;margin:0 auto;padding:0 20px}

    /* ===== Header & Navigation ===== */
    .site-header{position:sticky;top:0;z-index:50;background:rgba(255,255,255,0.95);backdrop-filter:blur(10px);border-bottom:1px solid #e2e8f0;transition:var(--transition)}
    .site-header .row{display:flex;align-items:center;justify-content:space-between;padding:14px 0;gap:12px}
    .brand{display:flex;align-items:center;gap:12px;transition:var(--transition)}
    .brand:hover{transform:translateY(-1px)}
    .brand img{height:48px;transition:var(--transition)}
    .brand .name{font-weight:700;letter-spacing:.2px;color:var(--brand-ink);background:linear-gradient(135deg, var(--brand), var(--accent));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}

    /* ===== Language Dropdown ===== */
    .lang-dropdown{position:relative;display:inline-block}
    .lang-current{
      display:flex;align-items:center;gap:6px;
      border:1px solid #e2e8f0;background:linear-gradient(135deg, #ffffff, #f8fafc);
      padding:6px 10px;border-radius:8px;font-size:12px;
      cursor:pointer;transition:var(--transition);
      min-width:80px;min-height:36px;
      box-shadow:0 2px 8px rgba(30, 64, 175, 0.05);
    }
    .lang-current:hover{border-color:var(--brand-light);box-shadow:0 4px 12px rgba(30, 64, 175, 0.15);background:linear-gradient(135deg, #ffffff, #f1f5f9)}
    .lang-current:focus{outline:2px solid var(--brand);outline-offset:2px}
    .lang-current[aria-expanded="true"]{border-color:var(--brand);box-shadow:0 4px 12px rgba(30, 64, 175, 0.2)}
    .lang-current[aria-expanded="true"] .lang-arrow{transform:rotate(180deg)}
    .lang-icon{font-size:14px}
    .lang-text{flex:1;text-align:left;font-size:12px;color:var(--ink-light)}
    .lang-arrow{transition:transform 0.2s ease;font-size:8px;color:var(--muted)}
    .lang-menu{
      position:absolute;top:100%;left:0;right:0;
      background:linear-gradient(135deg, #ffffff, #f8fafc);border:1px solid #e2e8f0;border-radius:8px;
      box-shadow:0 8px 32px rgba(30, 64, 175, 0.15);
      opacity:0;visibility:hidden;transform:translateY(-10px);
      transition:all 0.2s ease;z-index:1000;
      margin-top:2px;min-width:120px;
    }
    .lang-menu.show{opacity:1;visibility:visible;transform:translateY(0)}
    .lang-option{
      display:flex;align-items:center;gap:6px;
      padding:8px 10px;cursor:pointer;transition:var(--transition);
      border:none;background:none;width:100%;text-align:left;
      font-size:12px;color:var(--ink-light);
    }
    .lang-option:hover{background:linear-gradient(135deg, #f1f5f9, #e2e8f0)}
    .lang-option:focus{outline:none;background:linear-gradient(135deg, var(--brand), var(--brand-light));color:#fff}
    .lang-option.active{background:linear-gradient(135deg, #eff6ff, #dbeafe);color:var(--brand);font-weight:600}
    .lang-option:first-child{border-radius:7px 7px 0 0}
    .lang-option:last-child{border-radius:0 0 7px 7px}
    .lang-option:only-child{border-radius:7px}
    .lang-check{width:14px;height:14px;display:flex;align-items:center;justify-content:center;font-size:10px;color:var(--brand)}

    /* ===== Page Header ===== */
    .page-header{
      position:relative;min-height:60vh;display:flex;align-items:center;justify-content:center;
      background:linear-gradient(135deg, #dbeafe 0%, #f0f9ff 50%, #fef3c7 100%);
      overflow:hidden;
    }
    .page-header::before{
      content:"";position:absolute;inset:0;
      background:url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grain" width="100" height="100" patternUnits="userSpaceOnUse"><circle cx="20" cy="20" r="1" fill="%23ffffff" opacity="0.1"/><circle cx="80" cy="40" r="0.5" fill="%23ffffff" opacity="0.1"/><circle cx="40" cy="80" r="1.5" fill="%23ffffff" opacity="0.1"/></pattern></defs><rect width="100" height="100" fill="url(%23grain)"/></svg>');
    }
    .page-header-content{
      position:relative;z-index:2;text-align:center;max-width:800px;padding:0 20px;
    }
    .page-title{
      font-size:48px;font-weight:800;margin:0 0 16px;
      background:linear-gradient(135deg, var(--brand-ink), var(--brand));
      -webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;
    }
    .page-subtitle{color:var(--ink-light);font-size:18px;line-height:1.6;margin:0}

    /* ===== Contact Form ===== */
    .contact-form-section{
      padding:100px 0 80px;
      background:linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 50%, #f8fafc 100%);
      min-height:100vh;
    }
    .form-container{
      max-width:900px;margin:0 auto;
      background:linear-gradient(135deg, #ffffff, #f8fafc);
      border-radius:20px;box-shadow:var(--shadow-hover);padding:48px;
      border:1px solid rgba(226, 232, 240, 0.8);position:relative;overflow:hidden;
    }
    .form-container::before{
      content:"";position:absolute;top:0;left:0;right:0;height:5px;
      background:linear-gradient(90deg, var(--brand), var(--accent), var(--gold));
      opacity:0.8;
    }
    .form-header{
      text-align:center;margin-bottom:40px;
    }
    .form-title{
      font-size:28px;font-weight:700;margin:0 0 16px;
      color:var(--brand-ink);
    }
    .form-desc{
      color:var(--ink-light);font-size:16px;line-height:1.6;margin:0;
    }
    .contact-form{
      display:grid;gap:24px;
    }
    .form-group{
      display:flex;flex-direction:column;gap:8px;
    }
    .form-row{
      display:grid;grid-template-columns:1fr 1fr;gap:24px;
    }
    .form-label{
      font-weight:600;color:var(--brand-ink);font-size:14px;
      display:flex;align-items:center;gap:4px;
    }
    .required{
      color:var(--error);font-size:12px;
    }
    .form-input, .form-select, .form-textarea{
      padding:16px;border:1px solid #e2e8f0;border-radius:8px;
      background:linear-gradient(135deg, #ffffff, #f8fafc);
      transition:var(--transition);font-size:14px;font-family:inherit;
    }
    .form-input:focus, .form-select:focus, .form-textarea:focus{
      outline:none;border-color:var(--brand);
      box-shadow:0 0 0 3px rgba(30, 64, 175, 0.1);
      background:#ffffff;
    }
    .form-textarea{
      resize:vertical;min-height:120px;
    }
    .form-submit{
      background:linear-gradient(135deg, var(--brand), var(--brand-light));
      color:#fff;border:none;padding:16px 32px;border-radius:12px;
      font-weight:600;font-size:16px;cursor:pointer;
      transition:var(--transition);position:relative;overflow:hidden;
    }
    .form-submit::before{
      content:"";position:absolute;top:0;left:-100%;width:100%;height:100%;
      background:linear-gradient(90deg,transparent,rgba(255,255,255,0.3),transparent);
      transition:left 0.5s ease;
    }
    .form-submit:hover::before{left:100%}
    .form-submit:hover{
      background:linear-gradient(135deg, #1e3a8a, var(--brand));
      transform:translateY(-2px);box-shadow:0 8px 32px rgba(30, 64, 175, 0.4);
    }
    .form-submit:disabled{
      opacity:0.6;cursor:not-allowed;transform:none;
    }

    /* ===== Success/Error States ===== */
    .form-success{
      background:linear-gradient(135deg, #f0fdf4, #dcfce7);
      border:1px solid rgba(34, 197, 94, 0.3);
      border-radius:8px;padding:16px;margin-bottom:24px;
      color:var(--success);text-align:center;font-weight:600;
    }
    .form-error{
      background:linear-gradient(135deg, #fef2f2, #fee2e2);
      border:1px solid rgba(239, 68, 68, 0.3);
      border-radius:8px;padding:16px;margin-bottom:24px;
      color:var(--error);text-align:center;font-weight:600;
    }
    .field-error{
      color:var(--error);font-size:12px;margin-top:4px;
    }

    /* ===== Footer ===== */
    footer{padding:32px 0;color:var(--muted-light);font-size:13px;text-align:center;border-top:1px solid #e2e8f0;background:linear-gradient(135deg, #0f172a, #1e293b);color:#94a3b8}

    /* ===== Responsive ===== */
    @media (max-width: 1024px){
      .form-row{grid-template-columns:1fr}
      .train-line-select{grid-template-columns:1fr}
      .checkbox-grid{grid-template-columns:repeat(auto-fill, minmax(160px, 1fr))}
      .station-checkbox-grid{grid-template-columns:repeat(auto-fill, minmax(120px, 1fr))}
    }
    @media (max-width: 640px){
      .contact-form-section{padding:80px 0 60px}
      .form-container{padding:32px 20px}
      .form-title{font-size:24px}
      .form-desc{font-size:14px}
      .checkbox-grid{grid-template-columns:1fr;gap:12px}
      .checkbox-item{padding:10px 14px}
      .station-checkbox-grid{grid-template-columns:repeat(auto-fill, minmax(100px, 1fr));gap:8px}
      .station-checkbox-item{padding:6px 10px}
      .station-checkbox-item label{font-size:12px}
      .station-checkbox-container{max-height:300px;padding:16px}
      .selected-stations-list{gap:6px}
      .selected-station-tag{padding:4px 8px;font-size:11px}
      .lang-current{min-width:70px;padding:4px 8px;font-size:11px;min-height:32px}
      .lang-text{font-size:11px}
      .lang-icon{font-size:12px}
      .lang-arrow{font-size:7px}
      .site-header .row{padding:10px 0}
      .brand .name{font-size:14px}
      .brand img{height:36px}
      .lang-menu{min-width:100px}
      .lang-option{padding:6px 8px;font-size:11px}
    }
    @media (max-width: 480px){
      .form-container{padding:24px 16px}
      .form-title{font-size:20px}
      .checkbox-item label{font-size:13px}
      .form-submit{padding:14px 24px;font-size:15px}
    }

    /* ===== Animations ===== */
    .fade-up{opacity:0;transform:translateY(20px);animation:fadeUp .8s ease forwards}
    @keyframes fadeUp{to{opacity:1;transform:none}}
    
    .fade-in{opacity:0;animation:fadeIn 0.8s ease forwards}
    @keyframes fadeIn{to{opacity:1}}

    /* ===== Accessibility ===== */
    @media (prefers-reduced-motion: reduce){
      *{animation-duration:0.01ms !important;animation-iteration-count:1 !important;transition-duration:0.01ms !important}
      html{scroll-behavior:auto}
    }

    /* ===== Focus styles ===== */
    *:focus{outline:2px solid var(--brand);outline-offset:2px}

    /* ===== Helper Text ===== */
    .helper-text{
      font-size:12px;color:var(--muted);margin-top:4px;line-height:1.4;
    }

    /* ===== Section Divider ===== */
    .section-divider{
      height:2px;background:linear-gradient(90deg, transparent, var(--brand-light), transparent);
      margin:32px 0;opacity:0.3;
    }

    /* ===== Custom Checkbox ===== */
    .checkbox-grid{
      display:grid;grid-template-columns:repeat(auto-fill, minmax(200px, 1fr));gap:16px;
      margin-top:12px;
    }
    .checkbox-item{
      display:flex;align-items:center;gap:10px;cursor:pointer;
      padding:12px 16px;border-radius:8px;
      background:linear-gradient(135deg, #f8fafc, #f1f5f9);
      border:1px solid #e2e8f0;transition:var(--transition);
    }
    .checkbox-item:hover{
      background:linear-gradient(135deg, #f1f5f9, #e2e8f0);
      border-color:var(--brand-light);
    }
    .checkbox-item input[type="checkbox"]{
      width:20px;height:20px;cursor:pointer;
      accent-color:var(--brand);
    }
    .checkbox-item label{
      cursor:pointer;font-size:14px;color:var(--ink);margin:0;
      user-select:none;
    }
    .checkbox-item input[type="checkbox"]:checked + label{
      font-weight:600;color:var(--brand);
    }

    /* ===== Train Line Selection ===== */
    .train-select-container{
      display:grid;gap:16px;
    }
    .train-line-select{
      display:grid;grid-template-columns:1fr 1fr;gap:16px;
    }
    .station-checkbox-container{
      display:none;
      margin-top:16px;padding:20px;
      background:linear-gradient(135deg, #f8fafc, #f1f5f9);
      border-radius:12px;border:1px solid #e2e8f0;
      max-height:400px;overflow-y:auto;
    }
    .station-checkbox-container.show{
      display:block;
    }
    .station-checkbox-grid{
      display:grid;grid-template-columns:repeat(auto-fill, minmax(140px, 1fr));gap:12px;
    }
    .station-checkbox-item{
      display:flex;align-items:center;gap:8px;
      padding:8px 12px;border-radius:6px;
      background:#ffffff;border:1px solid #e2e8f0;
      transition:var(--transition);cursor:pointer;
    }
    .station-checkbox-item:hover{
      border-color:var(--brand-light);
      background:linear-gradient(135deg, #ffffff, #f8fafc);
    }
    .station-checkbox-item input[type="checkbox"]{
      width:18px;height:18px;cursor:pointer;
      accent-color:var(--brand);
    }
    .station-checkbox-item label{
      cursor:pointer;font-size:13px;color:var(--ink);margin:0;
      user-select:none;flex:1;
    }
    .station-checkbox-item input[type="checkbox"]:checked + label{
      font-weight:600;color:var(--brand);
    }
    .selected-stations-display{
      display:none;
      margin-top:16px;padding:16px;
      background:linear-gradient(135deg, #eff6ff, #dbeafe);
      border-radius:8px;border:1px solid rgba(59, 130, 246, 0.3);
    }
    .selected-stations-display.show{
      display:block;
    }
    .selected-stations-title{
      font-size:13px;font-weight:600;color:var(--brand);
      margin:0 0 12px;
    }
    .selected-stations-list{
      display:flex;flex-wrap:wrap;gap:8px;
    }
    .selected-station-tag{
      display:inline-flex;align-items:center;gap:6px;
      padding:6px 12px;background:#ffffff;border-radius:6px;
      border:1px solid var(--brand-light);
      font-size:12px;color:var(--brand-ink);
    }
    .selected-station-tag .remove-station{
      cursor:pointer;color:var(--error);font-weight:700;
      transition:var(--transition);
    }
    .selected-station-tag .remove-station:hover{
      color:#dc2626;
    }
    .other-input-container{
      display:none;
      margin-top:16px;
    }
    .other-input-container.show{
      display:block;
    }
    .line-category-title{
      font-size:14px;font-weight:700;color:var(--brand-ink);
      margin:20px 0 12px;padding-bottom:8px;
      border-bottom:2px solid var(--brand-light);
    }
    .line-category-title:first-child{
      margin-top:0;
    }
  </style>
</head>
<body>
  <!-- Header -->
  <header class="site-header">
    <div class="container row">
      <a href="#" class="brand">
        <img src="logo.png" alt="Smart Eyes" onerror="this.style.display='none'" />
        <div class="name">SMART EYES</div>
      </a>
      
      <div class="nav-container">
        <!-- Language Dropdown -->
        <div class="lang-dropdown" id="langDropdown">
          <button class="lang-current" id="langCurrent" aria-haspopup="true" aria-expanded="false">
            <span class="lang-icon">ğŸŒ</span>
            <span class="lang-text">æ—¥æœ¬èª</span>
            <span class="lang-arrow">â–¼</span>
          </button>
          <div class="lang-menu" id="langMenu" role="menu">
            <!-- Language options will be dynamically generated by JS -->
          </div>
        </div>
      </div>
    </div>
  </header>

  <!-- Rental Form -->
  <section class="contact-form-section">
    <div class="container">
      <div class="form-container fade-up">
        <div class="form-header">
          <h2 class="form-title" data-i18n="rental.formTitle">è³ƒè²¸ç‰©ä»¶ãŠå•ã„åˆã‚ã›ãƒ•ã‚©ãƒ¼ãƒ </h2>
          <p class="form-desc" data-i18n="rental.formDescription">
            ä¸‹è¨˜ãƒ•ã‚©ãƒ¼ãƒ ã«ã”å…¥åŠ›ã„ãŸã ãã€é€ä¿¡ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãã ã•ã„ã€‚
            2å–¶æ¥­æ—¥ä»¥å†…ã«ã”è¿”ä¿¡ã„ãŸã—ã¾ã™ã€‚
          </p>
        </div>
        
        <div id="formMessage"></div>
        
        <form class="contact-form" id="rentalForm">
          <!-- åŸºæœ¬æƒ…å ± -->
          <div class="form-group">
            <label class="form-label" for="fullName">
              <span data-i18n="rental.formFullName">ãŠåå‰</span>
              <span class="required">*</span>
            </label>
            <input type="text" id="fullName" name="fullName" class="form-input" required>
            <div class="field-error" id="fullNameError"></div>
          </div>
          
          <div class="form-row">
            <div class="form-group">
              <label class="form-label" for="email">
                <span data-i18n="rental.formEmail">ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹</span>
                <span class="required">*</span>
              </label>
              <input type="email" id="email" name="email" class="form-input" required>
              <div class="field-error" id="emailError"></div>
            </div>
            <div class="form-group">
              <label class="form-label" for="phone">
                <span data-i18n="rental.formPhone">é›»è©±ç•ªå·</span>
                <span class="required">*</span>
              </label>
              <input type="tel" id="phone" name="phone" class="form-input" required>
              <div class="field-error" id="phoneError"></div>
            </div>
          </div>

          <div class="section-divider"></div>

          <!-- è³ƒè²¸ç‰©ä»¶ã®å¸Œæœ›æ¡ä»¶ -->
          <div class="form-row">
            <div class="form-group">
              <label class="form-label" for="propertyType">
                <span data-i18n="rental.formPropertyType">ç‰©ä»¶ã‚¿ã‚¤ãƒ—</span>
                <span class="required">*</span>
              </label>
              <select id="propertyType" name="propertyType" class="form-select" required>
                <option value="" data-i18n="rental.formPropertyTypeSelect">é¸æŠã—ã¦ãã ã•ã„</option>
                <option value="apartment" data-i18n="rental.formPropertyTypeApartment">ãƒãƒ³ã‚·ãƒ§ãƒ³ãƒ»ã‚¢ãƒ‘ãƒ¼ãƒˆ</option>
                <option value="house" data-i18n="rental.formPropertyTypeHouse">ä¸€æˆ¸å»ºã¦</option>
                <option value="office" data-i18n="rental.formPropertyTypeOffice">ã‚ªãƒ•ã‚£ã‚¹ãƒ»äº‹å‹™æ‰€</option>
                <option value="store" data-i18n="rental.formPropertyTypeStore">åº—èˆ—</option>
                <option value="other" data-i18n="rental.formPropertyTypeOther">ãã®ä»–</option>
              </select>
              <div class="field-error" id="propertyTypeError"></div>
            </div>
            <div class="form-group">
              <label class="form-label" for="budget">
                <span data-i18n="rental.formBudget">ã”äºˆç®—ï¼ˆæœˆé¡ï¼‰</span>
                <span class="required">*</span>
              </label>
              <select id="budget" name="budget" class="form-select" required>
                <option value="" data-i18n="rental.formBudgetSelect">é¸æŠã—ã¦ãã ã•ã„</option>
                <option value="~50000" data-i18n="rental.formBudget50">5ä¸‡å††ä»¥ä¸‹</option>
                <option value="50000-100000" data-i18n="rental.formBudget50to100">5ä¸‡å††ã€œ10ä¸‡å††</option>
                <option value="100000-150000" data-i18n="rental.formBudget100to150">10ä¸‡å††ã€œ15ä¸‡å††</option>
                <option value="150000-200000" data-i18n="rental.formBudget150to200">15ä¸‡å††ã€œ20ä¸‡å††</option>
                <option value="200000-300000" data-i18n="rental.formBudget200to300">20ä¸‡å††ã€œ30ä¸‡å††</option>
                <option value="300000+" data-i18n="rental.formBudget300">30ä¸‡å††ä»¥ä¸Š</option>
              </select>
              <div class="field-error" id="budgetError"></div>
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label class="form-label" for="area">
                <span data-i18n="rental.formArea">å¸Œæœ›ã‚¨ãƒªã‚¢</span>
                <span class="required">*</span>
              </label>
              <select id="area" name="area" class="form-select" required>
                <option value="" data-i18n="rental.formAreaSelect">é¸æŠã—ã¦ãã ã•ã„</option>
                <option value="shinjuku" data-i18n="rental.formAreaShinjuku">æ–°å®¿åŒº</option>
                <option value="shibuya" data-i18n="rental.formAreaShibuya">æ¸‹è°·åŒº</option>
                <option value="minato" data-i18n="rental.formAreaMinato">æ¸¯åŒº</option>
                <option value="chiyoda" data-i18n="rental.formAreaChiyoda">åƒä»£ç”°åŒº</option>
                <option value="chuo" data-i18n="rental.formAreaChuo">ä¸­å¤®åŒº</option>
                <option value="meguro" data-i18n="rental.formAreaMeguro">ç›®é»’åŒº</option>
                <option value="setagaya" data-i18n="rental.formAreaSetagaya">ä¸–ç”°è°·åŒº</option>
                <option value="other-tokyo" data-i18n="rental.formAreaOtherTokyo">ãã®ä»–æ±äº¬23åŒº</option>
                <option value="other" data-i18n="rental.formAreaOther">ãã®ä»–</option>
              </select>
              <div class="field-error" id="areaError"></div>
            </div>
            <div class="form-group">
              <label class="form-label" for="rooms">
                <span data-i18n="rental.formRooms">é–“å–ã‚Š</span>
                <span class="required">*</span>
              </label>
              <select id="rooms" name="rooms" class="form-select" required>
                <option value="" data-i18n="rental.formRoomsSelect">é¸æŠã—ã¦ãã ã•ã„</option>
                <option value="1R" data-i18n="rental.formRooms1R">ãƒ¯ãƒ³ãƒ«ãƒ¼ãƒ </option>
                <option value="1K" data-i18n="rental.formRooms1K">1K</option>
                <option value="1DK" data-i18n="rental.formRooms1DK">1DK</option>
                <option value="1LDK" data-i18n="rental.formRooms1LDK">1LDK</option>
                <option value="2K" data-i18n="rental.formRooms2K">2K</option>
                <option value="2DK" data-i18n="rental.formRooms2DK">2DK</option>
                <option value="2LDK" data-i18n="rental.formRooms2LDK">2LDK</option>
                <option value="3LDK+" data-i18n="rental.formRooms3LDK">3LDKä»¥ä¸Š</option>
                <option value="flexible" data-i18n="rental.formRoomsFlexible">ç›¸è«‡å¯</option>
              </select>
              <div class="field-error" id="roomsError"></div>
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label class="form-label" for="moveInDate">
                <span data-i18n="rental.formMoveInDate">å…¥å±…å¸Œæœ›æ™‚æœŸ</span>
                <span class="required">*</span>
              </label>
              <select id="moveInDate" name="moveInDate" class="form-select" required>
                <option value="" data-i18n="rental.formMoveInDateSelect">é¸æŠã—ã¦ãã ã•ã„</option>
                <option value="immediate" data-i18n="rental.formMoveInImmediate">ã™ã</option>
                <option value="1month" data-i18n="rental.formMoveIn1Month">1ãƒ¶æœˆä»¥å†…</option>
                <option value="2months" data-i18n="rental.formMoveIn2Months">2ãƒ¶æœˆä»¥å†…</option>
                <option value="3months" data-i18n="rental.formMoveIn3Months">3ãƒ¶æœˆä»¥å†…</option>
                <option value="flexible" data-i18n="rental.formMoveInFlexible">ç›¸è«‡å¯</option>
              </select>
              <div class="field-error" id="moveInDateError"></div>
            </div>
            <div class="form-group">
              <label class="form-label" for="language">
                <span data-i18n="rental.formLanguage">ã”å¸Œæœ›ã®å¯¾å¿œè¨€èª</span>
              </label>
              <select id="language" name="language" class="form-select">
                <option value="ja" data-i18n="rental.formLanguageJa">æ—¥æœ¬èª</option>
                <option value="zh" data-i18n="rental.formLanguageZh">ä¸­å›½èªï¼ˆç°¡ä½“å­—ï¼‰</option>
                <option value="zh-Hant" data-i18n="rental.formLanguageZhHant">ä¸­å›½èªï¼ˆç¹ä½“å­—ï¼‰</option>
                <option value="en" data-i18n="rental.formLanguageEn">è‹±èª</option>
                <option value="ko" data-i18n="rental.formLanguageKo">éŸ“å›½èª</option>
                <option value="vi" data-i18n="rental.formLanguageVi">ãƒ™ãƒˆãƒŠãƒ èª</option>
                <option value="ne" data-i18n="rental.formLanguageNe">ãƒãƒ‘ãƒ¼ãƒ«èª</option>
              </select>
            </div>
          </div>

          <div class="section-divider"></div>

          <!-- é›»è»Šç·šè·¯ãƒ»é§… -->
          <div class="form-group">
            <label class="form-label">
              <span data-i18n="rental.formTrainLine">æœ€å¯„ã‚Šé§…ï¼ˆé›»è»Šç·šè·¯ï¼‰</span>
            </label>
            <div class="train-select-container">
              <div class="train-line-select">
                <div class="form-group" style="margin:0">
                  <select id="trainLine" name="trainLine" class="form-select">
                    <option value="" data-i18n="rental.formTrainLineSelect">é¸æŠã—ã¦ãã ã•ã„</option>
                    <option value="other" data-i18n="rental.formTrainLineOther">ãã®ä»–ï¼ˆæ‰‹å…¥åŠ›ï¼‰</option>
                  </select>
                </div>
                <div class="form-group" style="margin:0">
                  <button type="button" id="clearStations" class="form-submit" style="padding:12px 20px;font-size:14px;display:none">
                    <span data-i18n="rental.clearStations">é¸æŠã‚’ã‚¯ãƒªã‚¢</span>
                  </button>
                </div>
              </div>
              
              <!-- è»Šç«™è¤‡é¸æ¡†å€åŸŸ -->
              <div class="station-checkbox-container" id="stationCheckboxContainer"></div>
              
              <!-- å·²é¸è»Šç«™é¡¯ç¤º -->
              <div class="selected-stations-display" id="selectedStationsDisplay">
                <div class="selected-stations-title" data-i18n="rental.selectedStations">é¸æŠã—ãŸé§…ï¼š</div>
                <div class="selected-stations-list" id="selectedStationsList"></div>
              </div>
              
              <!-- å…¶ä»–ç·šè·¯æ‰‹å·¥å¡«å¯« -->
              <div class="other-input-container" id="otherTrainContainer">
                <input type="text" id="otherTrain" name="otherTrain" class="form-input" 
                       placeholder="ç·šè·¯ãƒ»é§…ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼ˆä¾‹ï¼šæ±æ€¥æ± ä¸Šç·š-æ——ã®å°é§…ï¼‰"
                       data-i18n="rental.formOtherTrainPlaceholder">
              </div>
            </div>
            <div class="helper-text" data-i18n="rental.formTrainHelper">
              ã”å¸Œæœ›ã®æœ€å¯„ã‚Šé§…ãŒã‚ã‚‹å ´åˆã¯ç·šè·¯ã‚’é¸æŠã—ã¦ã‹ã‚‰é§…ã«ãƒã‚§ãƒƒã‚¯ã‚’å…¥ã‚Œã¦ãã ã•ã„ï¼ˆè¤‡æ•°é¸æŠå¯ï¼‰
            </div>
          </div>

          <div class="section-divider"></div>

          <!-- ç‰©ä»¶æ¡ä»¶ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ -->
          <div class="form-group">
            <label class="form-label">
              <span data-i18n="rental.formConditions">ç‰©ä»¶ã®æ¡ä»¶</span>
            </label>
            <div class="checkbox-grid">
              <div class="checkbox-item">
                <input type="checkbox" id="bathToiletSeparate" name="bathToiletSeparate" value="yes">
                <label for="bathToiletSeparate" data-i18n="rental.conditionBathToilet">ãƒã‚¹ãƒ»ãƒˆã‚¤ãƒ¬åˆ¥</label>
              </div>
              <div class="checkbox-item">
                <input type="checkbox" id="parking" name="parking" value="yes">
                <label for="parking" data-i18n="rental.conditionParking">é§è»Šå ´</label>
              </div>
              <div class="checkbox-item">
                <input type="checkbox" id="bikeParking" name="bikeParking" value="yes">
                <label for="bikeParking" data-i18n="rental.conditionBikeParking">é§è¼ªå ´</label>
              </div>
              <div class="checkbox-item">
                <input type="checkbox" id="southFacing" name="southFacing" value="yes">
                <label for="southFacing" data-i18n="rental.conditionSouthFacing">å—å‘ã</label>
              </div>
              <div class="checkbox-item">
                <input type="checkbox" id="autoLock" name="autoLock" value="yes">
                <label for="autoLock" data-i18n="rental.conditionAutoLock">ã‚ªãƒ¼ãƒˆãƒ­ãƒƒã‚¯</label>
              </div>
              <div class="checkbox-item">
                <input type="checkbox" id="secondFloor" name="secondFloor" value="yes">
                <label for="secondFloor" data-i18n="rental.conditionSecondFloor">2éšä»¥ä¸Š</label>
              </div>
              <div class="checkbox-item">
                <input type="checkbox" id="petFriendly" name="petFriendly" value="yes">
                <label for="petFriendly" data-i18n="rental.conditionPetFriendly">ãƒšãƒƒãƒˆå¯</label>
              </div>
            </div>
            <div class="helper-text" data-i18n="rental.formConditionsHelper">
              ã”å¸Œæœ›ã®æ¡ä»¶ãŒã‚ã‚Œã°é¸æŠã—ã¦ãã ã•ã„ï¼ˆè¤‡æ•°é¸æŠå¯ï¼‰
            </div>
          </div>

          <div class="section-divider"></div>

          <!-- ãã®ä»–ã®è¦æœ› -->
          <div class="form-group">
            <label class="form-label" for="requirements">
              <span data-i18n="rental.formRequirements">ãã®ä»–ã”è¦æœ›ãƒ»æ¡ä»¶</span>
            </label>
            <textarea id="requirements" name="requirements" class="form-textarea" 
                      data-i18n="rental.formRequirementsPlaceholder" 
                      placeholder="ãƒšãƒƒãƒˆå¯ã€æ¥½å™¨å¯ã€é§è»Šå ´å¿…é ˆãªã©ã€ã”å¸Œæœ›ã®æ¡ä»¶ã‚’ã”è¨˜å…¥ãã ã•ã„"></textarea>
            <div class="helper-text" data-i18n="rental.formRequirementsHelper">
              ä¾‹ï¼šãƒšãƒƒãƒˆå¯ã€æ¥½å™¨å¯ã€ãƒã‚¹ãƒ»ãƒˆã‚¤ãƒ¬åˆ¥ã€é§è»Šå ´å¿…é ˆã€ã‚ªãƒ¼ãƒˆãƒ­ãƒƒã‚¯ã€2éšä»¥ä¸Šãªã©
            </div>
          </div>
          
          <button type="submit" class="form-submit" id="submitButton">
            <span data-i18n="rental.formSubmit">é€ä¿¡ã™ã‚‹</span>
          </button>
        </form>
      </div>
    </div>
  </section>

  <!-- Footer -->
  <footer>
    <div class="container">
      <p data-i18n="footer.copyright">&copy; 2024 æ ªå¼ä¼šç¤¾ã‚¹ãƒãƒ¼ãƒˆã‚¢ã‚¤ã‚º All Rights Reserved.</p>
    </div>
  </footer>

  <script>
    // ===== Global Train Data =====
    let TRAIN_DATA = null;
    let selectedStations = new Map(); // Map<lineKey, Set<stationName>>

    // ===== Load Train Stations Data =====
    async function loadTrainData() {
      try {
        const response = await fetch('train-stations.json');
        if (!response.ok) throw new Error('Failed to load train data');
        TRAIN_DATA = await response.json();
        console.log('Train data loaded successfully');
        return true;
      } catch (error) {
        console.error('Error loading train data:', error);
        // Fallback to basic data if JSON fails
        TRAIN_DATA = {
          tokyo_jr: {
            yamanote: {
              name: "JRå±±æ‰‹ç·š",
              name_zh: "JRå±±æ‰‹çº¿",
              name_en: "JR Yamanote Line",
              stations: ["æ±äº¬", "æ–°å®¿", "æ¸‹è°·", "å“å·", "æ± è¢‹", "ä¸Šé‡"]
            }
          }
        };
        return false;
      }
    }

    // ===== Rental Form Manager =====
    class RentalFormManager {
      constructor() {
        this.form = document.getElementById('rentalForm');
        this.submitButton = document.getElementById('submitButton');
        this.messageContainer = document.getElementById('formMessage');
        this.trainLineSelect = document.getElementById('trainLine');
        this.stationCheckboxContainer = document.getElementById('stationCheckboxContainer');
        this.selectedStationsDisplay = document.getElementById('selectedStationsDisplay');
        this.selectedStationsList = document.getElementById('selectedStationsList');
        this.otherTrainContainer = document.getElementById('otherTrainContainer');
        this.otherTrainInput = document.getElementById('otherTrain');
        this.clearButton = document.getElementById('clearStations');
      }

      async init() {
        await loadTrainData();
        this.buildTrainLineOptions();
        this.form.addEventListener('submit', (e) => this.handleSubmit(e));
        this.trainLineSelect.addEventListener('change', (e) => this.handleTrainLineChange(e));
        this.clearButton.addEventListener('click', () => this.clearAllStations());
      }

      buildTrainLineOptions() {
        if (!TRAIN_DATA) return;

        const categories = {
          'tokyo_jr': { title: 'æ±äº¬JRç·š', title_zh: 'ä¸œäº¬JRçº¿', title_en: 'Tokyo JR Lines' },
          'tokyo_metro': { title: 'æ±äº¬ãƒ¡ãƒˆãƒ­', title_zh: 'ä¸œäº¬åœ°é“', title_en: 'Tokyo Metro' },
          'tokyo_private': { title: 'æ±äº¬ç§é‰„', title_zh: 'ä¸œäº¬ç§é“', title_en: 'Tokyo Private Railways' },
          'kanagawa': { title: 'ç¥å¥ˆå·çœŒ', title_zh: 'ç¥å¥ˆå·å¿', title_en: 'Kanagawa' },
          'saitama': { title: 'åŸ¼ç‰çœŒ', title_zh: 'åŸ¼ç‰å¿', title_en: 'Saitama' },
          'chiba': { title: 'åƒè‘‰çœŒ', title_zh: 'åƒå¶å¿', title_en: 'Chiba' }
        };

        Object.entries(categories).forEach(([categoryKey, categoryInfo]) => {
          if (TRAIN_DATA[categoryKey]) {
            const optgroup = document.createElement('optgroup');
            optgroup.label = categoryInfo.title;
            
            Object.entries(TRAIN_DATA[categoryKey]).forEach(([lineKey, lineInfo]) => {
              const option = document.createElement('option');
              option.value = `${categoryKey}.${lineKey}`;
              option.textContent = lineInfo.name;
              optgroup.appendChild(option);
            });
            
            this.trainLineSelect.appendChild(optgroup);
          }
        });
      }

      handleTrainLineChange(e) {
        const selectedValue = e.target.value;
        
        if (selectedValue === 'other') {
          this.stationCheckboxContainer.classList.remove('show');
          this.otherTrainContainer.classList.add('show');
          this.clearButton.style.display = 'none';
        } else if (selectedValue) {
          this.otherTrainContainer.classList.remove('show');
          this.displayStationCheckboxes(selectedValue);
          this.clearButton.style.display = 'block';
        } else {
          this.stationCheckboxContainer.classList.remove('show');
          this.otherTrainContainer.classList.remove('show');
          this.clearButton.style.display = 'none';
        }
      }

      displayStationCheckboxes(lineValue) {
        const [category, lineKey] = lineValue.split('.');
        const lineData = TRAIN_DATA[category][lineKey];
        
        if (!lineData || !lineData.stations) return;

        this.stationCheckboxContainer.innerHTML = '';
        const grid = document.createElement('div');
        grid.className = 'station-checkbox-grid';

        lineData.stations.forEach((station, index) => {
          const item = document.createElement('div');
          item.className = 'station-checkbox-item';
          
          const checkbox = document.createElement('input');
          checkbox.type = 'checkbox';
          checkbox.id = `station_${lineValue}_${index}`;
          checkbox.value = station;
          checkbox.dataset.line = lineValue;
          checkbox.dataset.lineName = lineData.name;
          
          // Check if already selected
          if (selectedStations.has(lineValue) && selectedStations.get(lineValue).has(station)) {
            checkbox.checked = true;
          }
          
          checkbox.addEventListener('change', (e) => this.handleStationChange(e));
          
          const label = document.createElement('label');
          label.htmlFor = checkbox.id;
          label.textContent = station;
          
          item.appendChild(checkbox);
          item.appendChild(label);
          grid.appendChild(item);
        });

        this.stationCheckboxContainer.appendChild(grid);
        this.stationCheckboxContainer.classList.add('show');
      }

      handleStationChange(e) {
        const checkbox = e.target;
        const lineValue = checkbox.dataset.line;
        const lineName = checkbox.dataset.lineName;
        const stationName = checkbox.value;

        if (checkbox.checked) {
          // Add to selected stations
          if (!selectedStations.has(lineValue)) {
            selectedStations.set(lineValue, new Set());
          }
          selectedStations.get(lineValue).add(stationName);
        } else {
          // Remove from selected stations
          if (selectedStations.has(lineValue)) {
            selectedStations.get(lineValue).delete(stationName);
            if (selectedStations.get(lineValue).size === 0) {
              selectedStations.delete(lineValue);
            }
          }
        }

        this.updateSelectedStationsDisplay();
      }

      updateSelectedStationsDisplay() {
        this.selectedStationsList.innerHTML = '';
        
        if (selectedStations.size === 0) {
          this.selectedStationsDisplay.classList.remove('show');
          return;
        }

        this.selectedStationsDisplay.classList.add('show');

        selectedStations.forEach((stations, lineValue) => {
          const [category, lineKey] = lineValue.split('.');
          const lineData = TRAIN_DATA[category][lineKey];
          
          stations.forEach(stationName => {
            const tag = document.createElement('div');
            tag.className = 'selected-station-tag';
            tag.innerHTML = `
              <span>${lineData.name} - ${stationName}</span>
              <span class="remove-station" data-line="${lineValue}" data-station="${stationName}">Ã—</span>
            `;
            
            tag.querySelector('.remove-station').addEventListener('click', (e) => {
              this.removeStation(e.target.dataset.line, e.target.dataset.station);
            });
            
            this.selectedStationsList.appendChild(tag);
          });
        });
      }

      removeStation(lineValue, stationName) {
        if (selectedStations.has(lineValue)) {
          selectedStations.get(lineValue).delete(stationName);
          if (selectedStations.get(lineValue).size === 0) {
            selectedStations.delete(lineValue);
          }
        }

        // Uncheck the checkbox
        const checkbox = document.querySelector(`input[data-line="${lineValue}"][value="${stationName}"]`);
        if (checkbox) checkbox.checked = false;

        this.updateSelectedStationsDisplay();
      }

      clearAllStations() {
        selectedStations.clear();
        this.updateSelectedStationsDisplay();
        
        // Uncheck all checkboxes
        this.stationCheckboxContainer.querySelectorAll('input[type="checkbox"]').forEach(cb => {
          cb.checked = false;
        });
      }

      async handleSubmit(e) {
        e.preventDefault();
        
        if (!this.validateForm()) {
          return;
        }

        this.submitButton.disabled = true;
        const originalText = this.submitButton.querySelector('span').textContent;
        this.submitButton.querySelector('span').textContent = 'é€ä¿¡ä¸­...';

        try {
          await this.submitForm();
          
          this.showMessage(
            'ãŠå•ã„åˆã‚ã›ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ã€‚2å–¶æ¥­æ—¥ä»¥å†…ã«ã”è¿”ä¿¡ã„ãŸã—ã¾ã™ã€‚',
            'success'
          );
          
          // Do NOT reset form - keep user's input visible
          // this.form.reset();
          // Instead just clear the stations
          // selectedStations.clear();
          // this.updateSelectedStationsDisplay();
          // this.stationCheckboxContainer.classList.remove('show');
          // this.otherTrainContainer.classList.remove('show');
        } catch (error) {
          console.error('Form submission error:', error);
          this.showMessage(
            'é€ä¿¡ã«å¤±æ•—ã—ã¾ã—ãŸã€‚ãŠæ‰‹æ•°ã§ã™ãŒã€ã‚‚ã†ä¸€åº¦ãŠè©¦ã—ãã ã•ã„ã€‚',
            'error'
          );
        } finally {
          this.submitButton.disabled = false;
          this.submitButton.querySelector('span').textContent = originalText;
        }
      }

      validateForm() {
        let isValid = true;
        const fields = ['fullName', 'email', 'phone', 'propertyType', 'budget', 'area', 'rooms', 'moveInDate'];
        
        fields.forEach(field => {
          const input = document.getElementById(field);
          const errorDiv = document.getElementById(`${field}Error`);
          
          if (input && input.hasAttribute('required') && !input.value.trim()) {
            if (errorDiv) {
              errorDiv.textContent = 'ã“ã®é …ç›®ã¯å¿…é ˆã§ã™';
            }
            isValid = false;
          } else if (errorDiv) {
            errorDiv.textContent = '';
          }
        });

        const email = document.getElementById('email');
        const emailError = document.getElementById('emailError');
        if (email && email.value && !this.isValidEmail(email.value)) {
          if (emailError) {
            emailError.textContent = 'æœ‰åŠ¹ãªãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„';
          }
          isValid = false;
        }

        return isValid;
      }

      isValidEmail(email) {
        return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
      }

      getCheckedConditions() {
        const conditions = [];
        const checkboxes = [
          { id: 'bathToiletSeparate', label: 'ãƒã‚¹ãƒ»ãƒˆã‚¤ãƒ¬åˆ¥' },
          { id: 'parking', label: 'é§è»Šå ´' },
          { id: 'bikeParking', label: 'é§è¼ªå ´' },
          { id: 'southFacing', label: 'å—å‘ã' },
          { id: 'autoLock', label: 'ã‚ªãƒ¼ãƒˆãƒ­ãƒƒã‚¯' },
          { id: 'secondFloor', label: '2éšä»¥ä¸Š' },
          { id: 'petFriendly', label: 'ãƒšãƒƒãƒˆå¯' }
        ];

        checkboxes.forEach(checkbox => {
          const element = document.getElementById(checkbox.id);
          if (element && element.checked) {
            conditions.push(checkbox.label);
          }
        });

        return conditions;
      }

      getTrainInfo() {
        const trainLine = this.trainLineSelect;
        const otherTrain = this.otherTrainInput;

        if (trainLine.value === 'other' && otherTrain.value.trim()) {
          return otherTrain.value.trim();
        } else if (selectedStations.size > 0) {
          const stationList = [];
          selectedStations.forEach((stations, lineValue) => {
            const [category, lineKey] = lineValue.split('.');
            const lineData = TRAIN_DATA[category][lineKey];
            const stationsArray = Array.from(stations);
            stationList.push(`${lineData.name}: ${stationsArray.join('ã€')}`);
          });
          return stationList.join('\n');
        }
        return 'ãªã—';
      }

      async submitForm() {
        const scriptUrl = 'https://script.google.com/macros/s/AKfycbzMWtKd26r5GJrrdYeVWazLOWIdUzpFynCg9VeVDwtxEbEO6z6EcLy7TJjhRAXSpqgtTw/exec';
        
        const propertyType = document.getElementById('propertyType');
        const budget = document.getElementById('budget');
        const area = document.getElementById('area');
        const rooms = document.getElementById('rooms');
        const moveInDate = document.getElementById('moveInDate');
        const requirements = document.getElementById('requirements');

        const conditions = this.getCheckedConditions();
        const trainInfo = this.getTrainInfo();

        const rentalDetails = `
ã€è³ƒè²¸ç‰©ä»¶ãŠå•ã„åˆã‚ã›ã€‘

â–  ç‰©ä»¶ã‚¿ã‚¤ãƒ—: ${propertyType.options[propertyType.selectedIndex].text}
â–  ã”äºˆç®—: ${budget.options[budget.selectedIndex].text}
â–  å¸Œæœ›ã‚¨ãƒªã‚¢: ${area.options[area.selectedIndex].text}
â–  é–“å–ã‚Š: ${rooms.options[rooms.selectedIndex].text}
â–  å…¥å±…å¸Œæœ›æ™‚æœŸ: ${moveInDate.options[moveInDate.selectedIndex].text}

â–  æœ€å¯„ã‚Šé§…:
${trainInfo}

â–  ç‰©ä»¶ã®æ¡ä»¶:
${conditions.length > 0 ? conditions.join('ã€') : 'ãªã—'}

â–  ãã®ä»–ã”è¦æœ›ãƒ»æ¡ä»¶:
${requirements.value || 'ãªã—'}
        `.trim();

        const fullName = document.getElementById('fullName').value;
        const nameParts = fullName.split(/\s+/);
        
        const formData = {
          lastName: nameParts.length > 1 ? nameParts[0] : fullName,
          firstName: nameParts.length > 1 ? nameParts.slice(1).join(' ') : '',
          email: document.getElementById('email').value,
          phone: document.getElementById('phone').value,
          inquiryType: 'rent',
          budget: budget.value,
          language: document.getElementById('language').value,
          message: rentalDetails,
          timestamp: new Date().toISOString(),
          source: 'rental_form'
        };
        
        await fetch(scriptUrl, {
          method: 'POST',
          mode: 'no-cors',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(formData)
        });
      }

      showMessage(message, type) {
        this.messageContainer.innerHTML = `
          <div class="form-${type}">
            ${message}
          </div>
        `;
        
        // Scroll to top to show message
        window.scrollTo({ top: 0, behavior: 'smooth' });
        
        // Don't auto-hide success messages
        if (type === 'error') {
          setTimeout(() => {
            this.messageContainer.innerHTML = '';
          }, 5000);
        }
      }
    }

    // ===== I18n Manager =====
    class I18nManager {
      constructor() {
        this.currentLang = 'ja';
        this.loadedLanguages = {};
        this.languages = {
          ja: 'æ—¥æœ¬èª',
          ko: 'í•œêµ­ì–´',
          zh: 'ç®€ä½“ä¸­æ–‡',
          'zh-Hant': 'ç¹é«”ä¸­æ–‡',
          en: 'English',
          vi: 'Tiáº¿ng Viá»‡t',
          ne: 'à¤¨à¥‡à¤ªà¤¾à¤²à¥€'
        };
        this.fallbackLang = 'ja';
      }

      async loadLanguage(lang) {
        if (this.loadedLanguages[lang]) {
          return this.loadedLanguages[lang];
        }

        try {
          const response = await fetch(`rental-form-${lang}.json`);
          if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
          }
          const data = await response.json();
          this.loadedLanguages[lang] = data;
          
          try {
            localStorage.setItem(`smarteyes_rental_lang_${lang}`, JSON.stringify(data));
            localStorage.setItem(`smarteyes_rental_lang_${lang}_timestamp`, Date.now().toString());
          } catch (e) {
            console.warn('Could not cache language data:', e);
          }
          
          return data;
        } catch (error) {
          console.warn(`Failed to load language ${lang}:`, error);
          
          try {
            const cached = localStorage.getItem(`smarteyes_rental_lang_${lang}`);
            if (cached) {
              const data = JSON.parse(cached);
              this.loadedLanguages[lang] = data;
              return data;
            }
          } catch (e) {
            console.warn('Could not load from cache:', e);
          }
          
          if (lang !== this.fallbackLang) {
            return this.loadLanguage(this.fallbackLang);
          }
          
          throw error;
        }
      }

      detectLanguage() {
        const urlParams = new URLSearchParams(window.location.search);
        const urlLang = urlParams.get('lang');
        if (urlLang && this.languages[urlLang]) {
          return urlLang;
        }

        try {
          const savedLang = localStorage.getItem('smarteyes_preferred_lang');
          if (savedLang && this.languages[savedLang]) {
            return savedLang;
          }
        } catch (e) {
          console.warn('Could not read from localStorage:', e);
        }

        const navLangs = navigator.languages || [navigator.language || navigator.userLanguage];
        for (const navLang of navLangs) {
          const code = navLang.toLowerCase();
          if (code.startsWith('zh-tw') || code.includes('hant')) return 'zh-Hant';
          if (code.startsWith('zh')) return 'zh';
          if (code.startsWith('ja')) return 'ja';
          if (code.startsWith('ko')) return 'ko';
          if (code.startsWith('vi')) return 'vi';
          if (code.startsWith('ne')) return 'ne';
          if (code.startsWith('en')) return 'en';
        }

        return this.fallbackLang;
      }

      getValue(path, data) {
        const keys = path.split('.');
        let value = data;
        for (const key of keys) {
          value = value && value[key];
          if (value === undefined) break;
        }
        return value;
      }

      async applyLanguage(lang) {
        try {
          const data = await this.loadLanguage(lang);
          
          document.querySelectorAll('[data-i18n]').forEach(el => {
            const key = el.getAttribute('data-i18n');
            const value = this.getValue(key, data);
            if (value !== undefined) {
              if (el.tagName === 'INPUT' && el.type === 'submit') {
                el.value = value;
              } else if (el.tagName === 'OPTION') {
                el.textContent = value;
              } else if (el.hasAttribute('placeholder')) {
                el.placeholder = value;
              } else {
                el.innerHTML = value;
              }
            }
          });

          if (data.meta && data.meta.title) {
            document.title = data.meta.title;
          }
          if (data.meta && data.meta.description) {
            const metaDesc = document.querySelector('meta[name="description"]');
            if (metaDesc) {
              metaDesc.setAttribute('content', data.meta.description);
            }
          }

          document.documentElement.lang = lang;
          
          try {
            localStorage.setItem('smarteyes_preferred_lang', lang);
          } catch (e) {
            console.warn('Could not save language preference:', e);
          }

          this.currentLang = lang;
          this.updateDropdown();
          
          console.log(`Language switched to: ${lang}`);
        } catch (error) {
          console.error('Failed to apply language:', error);
          
          if (lang !== this.fallbackLang) {
            console.log(`Falling back to ${this.fallbackLang}`);
            return this.applyLanguage(this.fallbackLang);
          }
        }
      }

      updateDropdown() {
        const currentButton = document.getElementById('langCurrent');
        const currentText = currentButton.querySelector('.lang-text');
        if (currentText) {
          currentText.textContent = this.languages[this.currentLang];
        }

        document.querySelectorAll('.lang-option').forEach(option => {
          const isActive = option.dataset.lang === this.currentLang;
          option.classList.toggle('active', isActive);
          const check = option.querySelector('.lang-check');
          if (check) {
            check.textContent = isActive ? 'âœ“' : '';
          }
        });
      }

      buildDropdown() {
        const currentButton = document.getElementById('langCurrent');
        const menu = document.getElementById('langMenu');
        
        Object.entries(this.languages).forEach(([code, name]) => {
          const option = document.createElement('button');
          option.className = 'lang-option';
          option.dataset.lang = code;
          option.setAttribute('role', 'menuitem');
          option.innerHTML = `
            <span class="lang-check"></span>
            <span>${name}</span>
          `;
          
          option.addEventListener('click', () => {
            this.applyLanguage(code);
            this.hideDropdown();
          });
          
          menu.appendChild(option);
        });

        currentButton.addEventListener('click', (e) => {
          e.stopPropagation();
          this.toggleDropdown();
        });

        document.addEventListener('click', () => {
          this.hideDropdown();
        });
      }

      toggleDropdown() {
        const menu = document.getElementById('langMenu');
        const isShown = menu.classList.contains('show');
        if (isShown) {
          this.hideDropdown();
        } else {
          this.showDropdown();
        }
      }

      showDropdown() {
        const currentButton = document.getElementById('langCurrent');
        const menu = document.getElementById('langMenu');
        
        currentButton.setAttribute('aria-expanded', 'true');
        menu.classList.add('show');
      }

      hideDropdown() {
        const currentButton = document.getElementById('langCurrent');
        const menu = document.getElementById('langMenu');
        
        currentButton.setAttribute('aria-expanded', 'false');
        menu.classList.remove('show');
      }
    }

    // ===== Performance Optimization =====
    function optimizePerformance() {
      function throttle(func, limit) {
        let inThrottle;
        return function() {
          const args = arguments;
          const context = this;
          if (!inThrottle) {
            func.apply(context, args);
            inThrottle = true;
            setTimeout(() => inThrottle = false, limit);
          }
        };
      }
      
      const handleScroll = throttle(() => {
        const header = document.querySelector('.site-header');
        if (window.scrollY > 100) {
          header.style.background = 'rgba(255,255,255,0.98)';
          header.style.boxShadow = '0 4px 20px rgba(30, 64, 175, 0.1)';
        } else {
          header.style.background = 'rgba(255,255,255,0.95)';
          header.style.boxShadow = 'none';
        }
      }, 16);
      
      window.addEventListener('scroll', handleScroll, { passive: true });
    }

    // ===== Main Initialization =====
    const i18n = new I18nManager();
    const rentalForm = new RentalFormManager();

    async function init() {
      i18n.buildDropdown();
      
      const detectedLang = i18n.detectLanguage();
      await i18n.applyLanguage(detectedLang);
      
      await rentalForm.init();
      
      optimizePerformance();
      
      console.log('Smart Eyes rental form initialized successfully');
    }

    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', init);
    } else {
      init();
    }
  </script>
</body>
</html>
